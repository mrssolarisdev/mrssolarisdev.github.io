<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <!-- Required meta tags -->
    <title>Atividade SO</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Style -->
    <!--<link rel="stylesheet" href="css/style.css">-->
    <!-- FontAwesome -->
    <link rel="stylesheet" href="icons/fontawesome/css/all.css">
    <!-- Babel Compiler-->
   <!--  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
 -->

	<!--<script type="text/babel" src="java.js"></script>-->

    <!-- Compatibility with later versions of IE -->
    <!--[if lt IE 9]><script src="js/html5shiv.js"></script>
	<![endif]-->
    <style type="text/css">
        body{
    background:#821136;
    background-size: cover;
}

.af{
    text-align: center;
}


@keyframes pula {
    0%{
        -o-transform: scale(0);
        transform: scale(0);
    }
    50%{
        -o-transform: scale(1);
        transform: scale(1);
    }

    75%{
        -o-transform: scale(0.5);
        transform: scale(0.5);
    }
    
    100%{
        -o-transform: scale(0);
        transform: scale(0);
    }
}
.pula:active{
    animation: pula 0.5s linear;
    -o-animation:pula 0.5s linear ;
    transition: all 1s linear;
}
    </style>
  </head>
  <body>
    <div class="conteiner">     
        <section class="col-md-12 d-flex justify-content-center align-items-center" style="margin-top: 10%">
            <table class="table table-light table-bordered table-stripped" id="tabela1">
            <thead class="thead-dark">
                <tr>
                    <th style="text-align: center;" class="lead">Selecionar configuração - Processos</th>
                </tr>
            </thead>
            <tbody>
               
            <td>
               <div class="form-group">
                    <label for="nome">Nome do processo</label>
                    <input type="text" class="form-control" name="" id="nome">
                    <label for="tamanho" class="mt-5">Tamanho do processo</label>
                    <div class="input-group">
                        <input type="number" name="" class="form-control" id="tamanho">
                        <div class="input-group-append">
                            <span class="input-group-text">Kb</span>
                        </div>
                    </div>
                    <button class="btn btn-dark btn-block mt-5" id="b-criar">Criar processo</button>
                </div>
            </td>
            </tbody>
        </table>
        </section>




         <section class="col-md-12 d-flex justify-content-center align-items-center" style="margin-top: 5%;">
           <table class="table table-primary table-info" id="tabela2" style="text-align: center;">
             <tr>
                <td colspan="2"><span>Processos:</span></td></tr>
                <thead class="thead-dark lead">
                    <th>Nome</th>
                    <th>Tamanho</th>
                </thead>
                <tbody id="proc"> 
               
                    <!--os processos ficam aqui-->
     
                </tbody>
            </table>
        </section>


         <section class="col-md-12 d-flex justify-content-center align-items-center" style="margin-top: 5%">
                    <table class="table table-light table-bordered table-stripped" id="tabela3">
                    <thead class="thead-dark">
                        <tr>
                            <th style="text-align: center;" class="lead">Selecionar configuração - Partições</th>
                        </tr>
                    </thead>
                    <tbody>
                       
                    <td>
                       <div class="form-group">
                            <label for="nome1">Nome da partição</label>
                            <input type="text" class="form-control" name="" id="nome1">
                            <label for="tamanho1" class="mt-5">Tamanho da partição</label>
                            <div class="input-group">
                                <input type="number" name="" class="form-control" id="tamanho1">
                                <div class="input-group-append">
                                    <span class="input-group-text">Kb</span>
                                </div>
                            </div>
                           <!--  <span class="text-danger">*a quantidade de processos será igual a quantidade de partições</span>não achei que teria influência ter mais ou menos partições em relação ao modo de alocar, só que alguns não seriam alocados -->
                            <button class="btn btn-dark btn-block mt-5" id="b-criarP">Criar partição</button>
                        </div>
                    </td>
                    </tbody>
                </table>
                </section>

                <section class="col-md-12 d-flex justify-content-center align-items-center" style="margin-top: 5%;">
                   <table class="table table-primary table-danger" id="tabela4" style="text-align: center;">

                        <thead class="thead-dark lead">
                            <tr>
                                <th>Nome</th>
                                <th>Tamanho</th>
                            </tr>
                        </thead>
                        <tbody id="part"> 
                       
                            <!--os processos ficam aqui-->
             
                        </tbody>
                    </table>
                </section>

                 <section class="col-md-12 d-flex justify-content-center align-items-center" style="margin-top: 5%">
                    <table class="table table-light table-bordered table-stripped" id="tabela5">
                    <thead class="thead-dark">
                        <tr>
                            <th style="text-align: center;" class="lead">Selecionar configuração - Tipo de alocação</th>
                        </tr>
                    </thead>
                    <tbody>    
                        <td>
                           <div class="form-group">
                                <select id="tipo" class="form-control">
                                    <option>Selecione</option>
                                    <option>Best-fit</option>
                                    <option>Worst-fit</option>
                                    <option>First-fit</option>
                                    <option>Next-fit</option>
                                </select>
                                <button class="btn btn-dark btn-block mt-5" id="b-conc">Concluir</button>
                            </div>
                        </td>
                    </tbody>
                     </table>
                </section>

                <section class="col-md-12 d-flex justify-content-center align-items-center" style="margin-top: 5%;">
                   <table class="table table-dark table-bordered" id="tabela6" style="text-align: center;">
                        <thead class="thead-dark lead">
                           <tr id="res">
                                
                            </tr>
                        </thead>
                        <tbody> 
                            <tr id="resultados">
                                <!--os processos ficam aqui-->
                            </tr>
                            
             
                        </tbody>
                    </table>
                </section>
</div>



                 

<script type="text/javascript">
    //------------- INTERFACE ---------------
//implementação de fato começa na linha 131

//variáveis globais

let contProc = 0; //contador de processos
let contPart = 0; // contador de partições
let memoria = []; // vetor de partições
let processos = []; //vetor de processos;

//event listeners
let b1= document.getElementById('b-criar');
b1.addEventListener("click",preencherTabProc);

let b2 = document.getElementById('b-criarP');
b2.addEventListener("click",preencherTabPart);

let b3 = document.getElementById('b-conc');
b3.addEventListener("click",concluir);

// classes
class Particao{
    constructor(nome,tam,proc="NA"){
        this.nome = nome;
        this.tam = tam;
        this.proc = proc;
    }
}

class Processo{
    constructor(nome,tam){
        this.nome = nome;
        this.tam = tam;
    }
}

//métodos de formulário
function preencherTabProc(){
    let campo1 = document.getElementById('nome').value;
    let campo2 = parseInt(document.getElementById('tamanho').value);
    let proc= document.getElementsByTagName('tbody')[1];
    if(campo1 && campo2 !== ""){//funciona pro campo numerico pq caractere vazio em js é considerado também como 0
        contProc++;
        proc.innerHTML+="<tr><td>"+campo1+"</td><td>"+campo2+"</td></tr>";
        let o = new Processo(campo1,parseInt(campo2));
        processos.push(o);
    }
    else{
        alert("Preencha os campos");
    }
    clearProc();
    console.log(contProc);
}

function preencherTabPart(){
    let campo1 = document.getElementById('nome1').value;
    let campo2 = parseInt(document.getElementById('tamanho1').value);
    let part= document.getElementsByTagName('tbody')[4];
    if(campo1 && campo2 !== ""){//funciona pro campo numerico pq caractere vazio em js é considerado também como 0
        contPart++;
        part.innerHTML+="<tr><td>"+campo1+"</td><td>"+campo2+"</td></tr>";
        let o = new Particao(campo1,parseInt(campo2));
        memoria.push(o);
    }
    else{
        alert("Preencha os campos");
    }
    clearPart();
    console.log(contPart);
}


function clearProc(){
    let x = document.getElementById('nome');
    let y = document.getElementById('tamanho');

    x.value="";
    y.value="";
}

function clearPart(){
    let x = document.getElementById('nome1');
    let y = document.getElementById('tamanho1');
    x.value="";
    y.value="";
}

function clearVector(){
    let x = document.getElementById('res').innerHTML="";
    let y= document.getElementById('resultados').innerHTML="";
    for(let i=0; i<memoria.length; i++)
        memoria[i].proc = "NA";
}

//métodos auxiliares

function concluir(){
    let op = document.getElementById('tipo').value;
    switch(op){
        case "Best-fit":
            clearVector();//limpa o vetor de memoria de possiveis alocacoes de processos de outro tipo que não o bestFit
            bestFit();
            break;
        case "Worst-fit":
            clearVector();//....
            worstFit();
            break;
        case "First-fit":
            clearVector();//....
            firstFit();
            break;
        case "Next-fit":
            clearVector();//....
            nextFit();
            break;
        default:
            alert("Selecione uma opção!");
            break;
    }
}

function apresentar(){
    let y = document.getElementById('res');
    let x = document.getElementById('resultados');
    for(let i=0; i<memoria.length; i++){
        y.innerHTML += "<th>"+memoria[i].nome+"<br>"+memoria[i].tam+"</th>";
        x.innerHTML += "<td>"+memoria[i].proc+"</td>";
    }
}

// métodos essenciais - IMPLEMENTAÇÃO DOS ALGORITMOS DE ALOCAÇÃO
function bestFit(){
    let p;
    let esc;
    let proc;
    let nomeProc;
    let part;
    let check=false;
    for (let i = 0; i <contProc; i++) {
        proc = processos[i].tam;
        nomeProc = processos[i].nome;
        esc=-1;//toda vez que vai se alocar um processo na memoria, a posição escolhida para adcionar o processo zera
        p = 999999;//garante que toda vez que um novo processo for ser alocado na memoria, a diferença entre o tam. do processo e o tam. da partição será menor que esse valor
        check=false; // toda vez que volta para alocar 
        for (let j = 0; j < contPart; j++) {
            part = memoria[j].tam;
            if((part-proc)>=0){//diferença entre o tamanho da partição e o tamanho do processo deve ser >=0 para que o processo caiba na partição
                if(memoria[j].proc=="NA"){ //checa se posicao da memória está vazia
                    a=part-proc; //guarda a diferença entre o tamanho da partição e do processo
                    if(a<=p){ //o que torna o best BEST mesmo é essa parte aqui(compara se a diferença entre a partição e o processo é menor que a diferença encontrada anteriormente)
                        esc=j;
                        p=a;//menor diferença encontrada
                        check= true;//checa se achou uma posicao melhor, se achou, o esc
                    }               // continua esse
                }
            }
        }
        if(check==false)
            esc=-1;

        if(esc!=-1)
            memoria[esc].proc=nomeProc;
    }
    apresentar();
    console.log(memoria);
}



function worstFit(){
    let p;
    let esc;
    let proc;
    let nomeProc;
    let part;
    let check=false;
    for (let i = 0; i <contProc; i++) {
        proc = processos[i].tam;
        nomeProc = processos[i].nome;
        esc=-1;//toda vez que vai se alocar um processo na memoria, a posição escolhida para adcionar o processo zera
        p = -999999;//garante que toda vez que um novo processo for ser alocado na memoria, a diferença entre o tam. do processo e o tam. da partição será maior que esse valor
        check=false; // toda vez que volta para alocar 
        for (let j = 0; j < contPart; j++) {
            part = memoria[j].tam;
            if((part-proc)>=0){//diferença entre o tamanho da partição e o tamanho do processo deve ser >=0 para que o processo caiba na partição
                if(memoria[j].proc=="NA"){ //checa se posicao da memória está vazia
                    a=part-proc; //guarda a diferença entre o tamanho da partição e do processo
                    if(a>=p){ //o que torna o best BEST mesmo é essa parte aqui(compara se a diferença entre a partição e o processo é menor que a diferença encontrada anteriormente)
                        esc=j;
                        p=a;//menor diferença encontrada
                        check= true;//checa se achou uma posicao melhor, se achou, o esc
                    }               // continua esse
                }
            }
        }
        if(check==false)
            esc=-1;

        if(esc!=-1)
            memoria[esc].proc=nomeProc;
    }
    apresentar();
    console.log(memoria);
}
function firstFit(){
    let esc;
    let proc;
    let nomeProc;
    let part;
    let check=false;
    let cont=0;
    for (let i = 0; i <contProc; i++) {
        proc = processos[i].tam;
        nomeProc = processos[i].nome;
        esc=-1;
        check=false;
        cont=0;
        for (let j = 0; j < contPart; j++) {
            part = memoria[j].tam;
            if((part-proc)>=0){
                if(memoria[j].proc=="NA"){//checa se posicao vazia
                    if(cont==0){//contador checa se o contador continua 0, se não continuar, significa que o processo já encontrou uma posição de memória na qual ele se encaixa(não importa se é uma posição enorme ou não) 
                        esc=j;// 
                        check= true;//checa se achou uma posicao melhor, se achou, o esc continua esse
                        cont++;//como o contador agora mudou pra 1, sempre que o processo tentar checar se pode entrar em uma outra posição de memoria, não vai poder alocá-la, por não atender a condição(cont==0)
                    }
                }
            }
        }
        if(check==false)
            esc=-1;

        if(esc!=-1)
            memoria[esc].proc=nomeProc;
    }
    apresentar();
    console.log(memoria);
}
function nextFit(){
    let esc;
    let proc;
    let nomeProc;
    let part;
    let check=false;
    let cont=0;
    let j = 0;
    let aloc = 0;
    let x = 0;
    //let y =0;
    for (let i = 0; i <contProc; i++) {
        proc = processos[i].tam;
        nomeProc = processos[i].nome;
        esc=-1;
        check=false;
        cont=0;
        // essa parte indica de onde o vetor memoria deve começar a rodar
        if(aloc!=0){//se for diferente de 0, aloc(posicao onde o processo foi alocado) mudou
            if(aloc==memoria.length-1) // se aloc é igual ao indice final do vetor memoria
                x=0; //entao x volta pra 0
            else
                x=aloc;//senao x assume o indice onde o processo foi alocado
        }
        else
            x=0;//se a posição não foi alocada x assume 0 e j começa de 0

        for (let j = x; j < contPart; j++) {
            part = memoria[j].tam;
            if((part-proc)>=0){
                if(memoria[j].proc=="NA"){//checa se posicao vazia
                    if(cont==0){//contador checa se o contador continua 0, se não continuar, significa que o processo já encontrou uma posição de memória na qual ele se encaixa(não importa se é uma posição enorme ou não) 
                        esc=j;// 
                        check= true;//checa se achou uma posicao melhor, se achou, o esc continua esse
                        cont++;//como o contador agora mudou pra 1, sempre que o processo tentar checar se pode entrar em uma outra posição de memoria, não vai poder alocá-la, por não atender a condição(cont==0) 
                        aloc = j;
                    }
                }
            }

        }
        
        if(check==false)
            esc=-1;

        if(esc!=-1)
            memoria[esc].proc=nomeProc;
    }
    apresentar();
    console.log(memoria);
}
</script>
    
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>


